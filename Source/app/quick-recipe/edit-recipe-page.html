<template>
    <div class="edit-recipe container">
        <div class="row">
            <div class="col hide-on-small-only m3 right">
                <div md-pushpin>
                    <ul class="section table-of-contents">
                        <li><a href="#summary">Summary</a></li>
                        <li><a href="#subrecipes">Subrecipes</a></li>
                        <li><a href="#ingredients">Ingredients</a></li>
                        <li><a href="#steps">Steps</a></li>
                    </ul>
                </div>
            </div>
            <div class="col s12 m9" md-scrollspy="target: .scrollspy">
                <form submit.delegate="saveRecipe()" role="form">
                    <section id="summary" class="section scrollspy">
                        <h2>Summary</h2>
                        <div class="row valign-wrapper">
                            <div class="col s3">
                                <img src.bind="recipe.smallImageUrl" alt="" class="responsive-img">
                            </div>
                            <div class="row col s9">
                                <div class="input-field col s12">
                                    <input value.bind="recipe.title" id="title" type="text">
                                    <label for="title">Title</label>
                                </div>
                                <div class="input-field col s12">
                                    <textarea value.bind="recipe.summary" id="summary" class="materialize-textarea"></textarea>
                                    <label for="summary">Summary</label>
                                </div>
                                <div class="input-field col s12">
                                    <input value.bind="recipe.note" id="note" type="text">
                                    <label for="note">Note</label>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="subrecipes" class="section scrollspy">
                        <h2>Subrecipes</h2>
                        <div class="row valign-wrapper" repeat.for="subrecipe of subrecipes" if.bind="subrecipe.id >= 0">
                            <div class="col s1">
                                <a class="btn-flat btn-floating btn-delete waves-effect waves-red" click.trigger="removeSubrecipe(subrecipe)">
                                    <i class="material-icons red-text">delete</i>
                                </a>
                            </div>
                            <div class="input-field col s11">
                                <input value.bind="subrecipe.title" id="title" type="text">
                                <label for="title">Title</label>
                            </div>
                        </div>
                        <div class="row">
                            <a class="btn-flat btn-large waves-effect waves-red red-text" click.trigger="addSubrecipe()">
                                <i class="material-icons left">add</i>Add subrecipe
                            </a>
                        </div>
                    </section>

                    <section id="ingredients" class="section scrollspy">
                        <h2>Ingredients</h2>
                        <div class="row">
        					<section repeat.for="subrecipe of subrecipes" if.bind="subrecipe.id >= 0" class="col s12">
                                <div class="row">
                                    <h4 class="truncate">${subrecipe.title}</h4>
                                </div>
        						<ul class="collection row">
        							<li repeat.for="ingredient of subrecipe.ingredients" class="collection-item valign-wrapper">
                                        <div class="col s1">
                                            <a class="btn-flat btn-floating btn-delete waves-effect waves-red" click.trigger="removeIngredient(subrecipe, ingredient)">
                                                <i class="material-icons red-text">delete</i>
                                            </a>
                                        </div>
                                        <div class="input-field col s2">
                                            <input value.bind="ingredient.quantity.value" id="quantity" type="number" step="0.1" class="right-align">
                                            <label for="quantity">Quantity</label>
                                        </div>
                                        <div class="input-field col s2">
                                            <select id="unit" md-select value.two-way="ingredient.quantity.abbreviation">
                                                <option repeat.for="measureUnit of measureUnits" model.bind="measureUnit.abbreviation">${measureUnit.abbreviation}</option>
                                            </select>
                                            <label class="active">Unit</label>
                                        </div>
                                        <div class="input-field col s7">
                                            <input value.bind="ingredient.name" id="ingredient" type="text">
                                            <label for="ingredient">Ingredient</label>
                                        </div>
        							</li>
        						</ul>
                                <div class="row">
                                    <a class="btn-flat waves-effect waves-red red-text" click.trigger="addIngredient(subrecipe)">
                                        <i class="material-icons left">add</i>Add ingredient
                                    </a>
                                </div>
        					</section>
                        </div>
                    </section>

                    <section id="steps" class="section scrollspy">
                        <h2>Steps</h2>
                        <div class="row">
        					<section repeat.for="subrecipe of subrecipes" class="col s12">
        						<h4 if.bind="subrecipe.title" class="truncate">${subrecipe.title}</h4>
        						<ul class="collection row">
        							<li repeat.for="step of subrecipe.steps" class="collection-item">
                                        <span repeat.for="part of step.parts">
                                            <a class="btn-flat btn-floating btn-delete waves-effect waves-red" click.trigger="removeStepPart(step, part)">
                                                <i class="material-icons red-text">delete</i>
                                            </a>
                                    		<compose model.bind="part" view-model="app/quick-recipe/components/edition-steps/step-${part.type}" containerless></compose>
                                        </span>
        							</li>
        						</ul>
                                <div class="row">
                                    <div class="col s12">
                                        <a class="btn-flat waves-effect waves-red red-text" click.trigger="addStep(subrecipe)">
                                            <i class="material-icons left">add</i>Add step
                                        </a>
                                    </div>
                                </div>
        					</section>
                        </div>
                    </section>

                    <button class="btn waves-effect waves-light" type="submit" name="action">Submit
                        <i class="material-icons right">send</i>
                    </button>
                </form>
            </div>
        </div>
    </div>
</template>
