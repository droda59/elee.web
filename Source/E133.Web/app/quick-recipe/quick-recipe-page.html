<template>
	<require from="quick-recipe/components/quick-recipe-header"></require>
	<require from="quick-recipe/components/quick-recipe-step"></require>
	<require from="quick-recipe/components/quick-recipe-footer"></require>
	<require from="quick-recipe/components/help-overlay"></require>
	<require from="shared/components/measurable-ingredient"></require>
	<!-- <require from="shared/components/comments-form"></require> -->
	<require from="shared/value-converters/duration-format"></require>

	<div class="quick-recipe">
		<header class="row z-depth-1">
			<quick-recipe-header containerless recipe.bind="recipe"></quick-recipe-header>
		</header>

		<main class="row">
			<div class="ingredients card hoverable hide-on-small-only col m3">
				<div class="card-image">
					<img src.bind="recipe.imageUrl">
					<div class="after"></div>
					<span class="card-title" i18n="quickRecipe.ingredientsSideTitle">Ingredients</span>
				</div>
				<div class="card-content">
					<section repeat.for="subrecipe of subrecipeIngredients" class="section">
						<h4 if.bind="subrecipe.subrecipeTitle" class="center truncate">${subrecipe.subrecipeTitle}</h4>
						<ul class="collection">
							<li repeat.for="ingredient of subrecipe.ingredients" class="collection-item ingredient-item">
								<measurable-ingredient containerless ingredient.bind="ingredient"></measurable-ingredient>
								<small if.bind="ingredient.replacements" repeat.for="replacement of ingredient.replacements">
									<div i18n="quickRecipe.ingredientReplacementConjunction">Or</div>
									<measurable-ingredient containerless ingredient.bind="replacement"></measurable-ingredient>
								</small>
							</li>
						</ul>
					</section>
				</div>
			</div>

			<div class="main section col s12 m9 offset-m3">
				<div class="content">
					<section id="presentation-section" if.bind="!isRecipeStarted" class="au-animate section">
						<div>
							<h3>${recipe.title}</h3>
							<div class="row">
								<div>
									<span i18n="quickRecipe.servings">Servings</span>${recipe.originalServings}
								</div>
							</div>

							<div class="row">
								<ul>
									<li repeat.for="duration of recipe.durations">
										${duration.title}: ${duration.time | durationFormat}
									</li>
								</ul>
							</div>

							<div class="row" if.bind="recipe.note">
								<p><span i18n="quickRecipe.note">Note</span>${recipe.note}</p>
							</div>

							<div class="row center">
								<a class="btn btn-large waves-effect waves-light" click.trigger="startRecipe()" i18n="quickRecipe.start">Start</a>
							</div>
						</div>
					</section>

					<section id="recipe-content" show.bind="isRecipeStarted && !isRecipeDone" class="au-animate">
						<nav class="navbar z-depth-1">
							<ul class="subrecipe-titles">
								<li repeat.for="subrecipe of recipe.subrecipes" class="subrecipe-title ${$parent.activeSubrecipeId === subrecipe.id ? 'active' : ''}">
									${subrecipe.title}
								</li>
							</ul>
						</nav>

						<quick-recipe-step repeat.for="step of recipe.steps" id="step-${$index}" step.bind="step" class="step"></quick-recipe-step>

						<span class="step-actions">
                            <btn class="current-button waves-light btn ${isCurrentStepActive ? 'disabled' : ''}" click.delegate="goToCurrentStep()">
                                <i class="material-icons">keyboard_arrow_up</i>
                            </btn>
                            <btn class="complete-button waves-light btn ${isCurrentStepActive ? '' : 'disabled'}" click.delegate="completeStep()">
                                <span if.bind="isLastStep" i18n="quickRecipe.finish">Finish</span>
								<i if.bind="!isLastStep" class="material-icons">done</i>
							</btn>
						</span>
					</section>

					<section id="comments-section" if.bind="isRecipeStarted && isRecipeDone" class="section">
						<div class="row center">
							<hgroup>
								<h3 i18n="quickRecipe.comments.didYouLikeExperience">DidYouLikeExperience</h3>
								<h4 i18n="quickRecipe.comments.wedLikeYourComments">WeLikeToHear</h4>
							</hgroup>
							<p i18n="quickRecipe.comments.writeComments">WriteComments</p>
						</div>

						<div class="row center">
							<a href="#typeform" class="btn btn-large btn-success waves-effect waves-light" i18n="comments.sendButton">
								Send
								<i class="material-icons right">send</i>
							</a>
						</div>

						<!-- <comments-form containerless></comments-form> -->
					</section>
				</div>
			</div>
		</main>

		<footer class="row page-footer fixed">
			<quick-recipe-footer containerless url.bind="recipe.originalUrl" title.bind="recipe.title"></quick-recipe-footer>
		</footer>
	</div>
</template>
